<!-- <div class="page">
  <header class="topbar">
    <div class="left">
      <div class="h1row"><span class="sq"></span><h1>Control Panel</h1></div>
      <a routerLink="/" class="back">‚Üê Retour au Dashboard</a>
    </div>
    <div class="right">
      <div class="sys" [class.online]="systemActive">
        <span class="dot"></span>{{ systemActive ? 'Syst√®me actif' : 'Hors ligne' }}
      </div>
      <button class="pill" (click)="exportCSV()">üìÑ CSV</button>
      <button class="pill" (click)="exportJSON()">üìÑ JSON</button>
    </div>
  </header>

  <nav class="tabs">
    @for (t of tabs; track t.id) {
      <button class="tab" [class.active]="activeTab === t.id" (click)="activeTab = t.id">
        {{ t.icon }} {{ t.label }}
      </button>
    }
  </nav>
  <div class="sep"></div>

  @if (activeTab === 'systeme') {
    <section class="grid">

      <article class="card">
        <h3>Mode Op√©rationnel</h3>
        <div class="mode">
          <button class="m" [class.on]="mode === 'auto'"   (click)="mode = 'auto'">AUTO ü§ñ</button>
          <button class="m" [class.on]="mode === 'manuel'" (click)="mode = 'manuel'">MANUEL ‚öôÔ∏è</button>
        </div>
        <p class="desc"><b>Auto:</b> Syst√®me contr√¥l√© automatiquement<br><b>Manuel:</b> Contr√¥le enti√®rement manuel</p>
      </article>

      <article class="card">
        <h3>Enregistrement des donn√©es</h3>
        <div class="row"><span>Activer l'enregistrement</span>
          <label class="toggle"><input type="checkbox" [(ngModel)]="recording"><span class="s"></span></label>
        </div>
        <div class="row"><span>Archivage automatique</span>
          <label class="toggle"><input type="checkbox" [(ngModel)]="autoArchive"><span class="s"></span></label>
        </div>
      </article>

      <article class="card">
        <h3>Notifications Syst√®me</h3>
        <div class="row"><span>Notifications desktop</span>
          <label class="toggle"><input type="checkbox" [(ngModel)]="desktopNotifs"><span class="s"></span></label>
        </div>
        <div class="row"><span>Sons d'alerte</span>
          <label class="toggle"><input type="checkbox" [(ngModel)]="soundAlerts"><span class="s"></span></label>
        </div>
      </article>

    </section>

    <section class="sensor">
      <h3>√âtat du capteur</h3>
      <div class="srow">
        <span class="name">Raspbery PI 5</span>
        <span class="badge" [class.ok]="systemActive">{{ systemActive ? '‚úì Connect√©' : '‚úó D√©connect√©' }}</span>
      </div>
      <p class="ts">Derni√®re mesure: {{ fmt(lastMesure?.timestamp) }}</p>
    </section>

  } @else {
    <div class="placeholder">Section {{ activeTab }} ‚Äî √† venir</div>
  }
</div> -->
<div class="page">

  <!-- Header -->
  <header class="topbar">
    <div class="left">
      <div class="h1row"><span class="sq"></span><h1>Control Panel</h1></div>
      <a routerLink="/" class="back">‚Üê Retour au Dashboard</a>
    </div>
    <div class="right">
      <div class="sys" [class.online]="systemActive">
        <span class="dot"></span>{{ systemActive ? 'Syst√®me actif' : 'Hors ligne' }}
      </div>
      <button class="pill" (click)="exportCSV()">üìÑ CSV</button>
      <button class="pill" (click)="exportJSON()">üìÑ JSON</button>
    </div>
  </header>

  <!-- Tabs -->
  <nav class="tabs">
    @for (t of tabs; track t.id) {
      <button class="tab" [class.active]="activeTab === t.id" (click)="activeTab = t.id">
        {{ t.icon }} {{ t.label }}
      </button>
    }
  </nav>
  <div class="sep"></div>

  <!-- ‚ïê‚ïê‚ïê SYST√àME ‚ïê‚ïê‚ïê -->
  @if (activeTab === 'systeme') {
    <section class="grid">
      <article class="card">
        <h3>Mode Op√©rationnel</h3>
        <div class="mode">
          <button class="m" [class.on]="mode === 'auto'"   (click)="mode = 'auto'">AUTO ü§ñ</button>
          <button class="m" [class.on]="mode === 'manuel'" (click)="mode = 'manuel'">MANUEL ‚öôÔ∏è</button>
        </div>
        <p class="desc"><b>Auto:</b> Syst√®me contr√¥l√© automatiquement<br><b>Manuel:</b> Contr√¥le enti√®rement manuel</p>
      </article>

      <article class="card">
        <h3>Enregistrement des donn√©es</h3>
        <div class="row"><span>Activer l'enregistrement</span>
          <label class="toggle"><input type="checkbox" [(ngModel)]="recording"><span class="s"></span></label>
        </div>
        <div class="row"><span>Archivage automatique</span>
          <label class="toggle"><input type="checkbox" [(ngModel)]="autoArchive"><span class="s"></span></label>
        </div>
      </article>

      <article class="card">
        <h3>Notifications Syst√®me</h3>
        <div class="row"><span>Notifications desktop</span>
          <label class="toggle"><input type="checkbox" [(ngModel)]="desktopNotifs"><span class="s"></span></label>
        </div>
        <div class="row"><span>Sons d'alerte</span>
          <label class="toggle"><input type="checkbox" [(ngModel)]="soundAlerts"><span class="s"></span></label>
        </div>
      </article>
    </section>

    <section class="sensor">
      <h3>√âtat du capteur</h3>
      <div class="srow">
        <span class="name">ESP8266-1:</span>
        <span class="badge" [class.ok]="systemActive">{{ systemActive ? '‚úì Connect√©' : '‚úó D√©connect√©' }}</span>
      </div>
      <p class="ts">Derni√®re mesure: {{ fmt(lastMesure?.timestamp) }}</p>
    </section>

  <!-- ‚ïê‚ïê‚ïê R√âSERVATIONS ‚ïê‚ïê‚ïê -->
  } @else if (activeTab === 'reservations') {

    <!-- S√©lecteur de salle + navigation semaine -->
    <div class="res-controls">
      <div>
        <span class="k">SALLE</span>
        <div class="room-tabs">
          @for (r of rooms; track r.id) {
            <button class="rtab" [class.active]="selectedRoomId === r.id"
                    (click)="selectedRoomId = r.id; onRoomChange()">
              {{ r.name }}<span class="cap"> ¬∑ {{ r.capacity }}p ¬∑ {{ r.floor }}</span>
            </button>
          }
        </div>
      </div>
      <div class="week-nav">
        <button class="nav-btn" (click)="prevWeek()">‚Äπ</button>
        <span class="week-label">{{ getWeekLabel() }}</span>
        <button class="nav-btn" (click)="nextWeek()">‚Ä∫</button>
      </div>
    </div>

    <!-- Calendrier -->
    <div class="cal-wrap">
      @if (resLoading) {
        <div class="cal-loading"><div class="spinner"></div></div>
      }
      <div class="calendar">

        <!-- En-t√™tes jours -->
        <div class="cal-head-empty"></div>
        @for (day of weekDays; track day.getTime()) {
          <div class="cal-head" [class.today]="isToday(day)">
            {{ getDayLabel(day) }}
            @if (isToday(day)) { <span class="today-dot"></span> }
          </div>
        }

        <!-- Lignes horaires -->
        @for (h of hours; track h) {
          <div class="time-label">{{ h }}h</div>
          @for (day of weekDays; track day.getTime()) {
            <div class="slot"
                 [class.free]="!isOccupied(day, h)"
                 [class.occ]="isOccupied(day, h)"
                 (click)="openModal(day, h)">
              @let res = getResAt(day, h);
              @if (res) {
                <div class="res-block" (click)="deleteRes(res.id!, $event)">
                  <div class="res-title">{{ res.title }}</div>
                  <div class="res-meta">{{ res.user_name }} ¬∑ {{ getDuration(res) }}min</div>
                  <button class="del-btn" (click)="deleteRes(res.id!, $event)">‚úï</button>
                </div>
              }
            </div>
          }
        }

      </div>
    </div>

    <!-- L√©gende -->
    <div class="legend">
      <span class="leg-free">‚óè Libre ‚Äî cliquer pour r√©server</span>
      <span class="leg-occ">‚óè Occup√©</span>
    </div>

  <!-- ‚ïê‚ïê‚ïê AUTRES ONGLETS ‚ïê‚ïê‚ïê -->
  } @else {
    <div class="placeholder">Section {{ activeTab }} ‚Äî √† venir</div>
  }

</div>

<!-- ‚ïê‚ïê‚ïê MODAL R√âSERVATION ‚ïê‚ïê‚ïê -->
@if (showModal && selectedSlot) {
  <div class="overlay" (click)="showModal = false">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Nouvelle r√©servation</h2>
        <button class="modal-close" (click)="showModal = false">‚úï</button>
      </div>
      <p class="modal-sub">{{ getDayLabel(selectedSlot.date) }} √† {{ selectedSlot.hour }}:00</p>

      @if (errorMsg) {
        <div class="error-msg">‚ö†Ô∏è {{ errorMsg }}</div>
      }

      <div class="field">
        <label>Titre / Cours</label>
        <input [(ngModel)]="form.title" placeholder="Ex: Cours de Maths" />
      </div>

      <div class="field">
        <label>Votre nom</label>
        <input [(ngModel)]="form.user_name" placeholder="Ex: M. Dupont" />
      </div>

      <div class="field-row">
        <div class="field">
          <label>Dur√©e</label>
          <select [(ngModel)]="form.duration">
            <option [value]="30">30 min</option>
            <option [value]="60">1h</option>
            <option [value]="90">1h30</option>
            <option [value]="120">2h</option>
          </select>
        </div>
        <div class="field">
          <label>Nb personnes</label>
          <input type="number" [(ngModel)]="form.people_count" min="1" max="200" />
        </div>
      </div>

      <div class="modal-actions">
        <button class="btn-cancel" (click)="showModal = false">Annuler</button>
        <button class="btn-ok" (click)="submit()">‚úì R√©server</button>
      </div>
    </div>
  </div>
}
